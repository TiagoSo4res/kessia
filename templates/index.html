<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carta para {{ carta.destinatario }}</title>
    <meta name="description" content="Carta digital de gratidão para Késsia - Uma expressão sincera de admiração e agradecimento">
    <meta name="keywords" content="carta, gratidão, Késsia, agradecimento, trabalho, liderança">
    <meta property="og:title" content="Carta de Gratidão para {{ carta.destinatario }}">
    <meta property="og:description" content="Uma carta digital expressando gratidão e admiração">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <!-- Container principal -->
    <div class="letter-container">
        <!-- Decoração de canto -->
        <div class="corner-decoration corner-top-left"></div>
        <div class="corner-decoration corner-bottom-right"></div>
        
        <!-- Marca d'água -->


        <!-- Header -->
        <div class="letter-header">
            <div class="recipient-name" id="animated-name">{{ carta.destinatario }}</div>
            <div class="recipient-subtitle">{{ carta.subtitulo }}</div>
        </div>

        <!-- Conteúdo -->
        <div class="letter-content">
            <!-- Data e saudação -->
            <div class="letter-meta">
                <div class="letter-date">{{ carta.data }}</div>
                <div class="letter-greeting">De coração Amadinha</div>
            </div>

            <!-- Texto da carta -->
            <div class="letter-text">
                {% for item in carta.conteudo %}
                <p>{{ item.paragrafo|safe }}</p>
                {% endfor %}
            </div>

            <!-- Assinatura -->
            <div class="letter-signature">
                <div class="signature-name">{{ carta.autor }}</div>
                <div class="signature-role">Com toda a minha estima e admiração</div>
            </div>
        </div>


    <!-- Botão de impressão flutuante -->
    <div class="print-button" onclick="window.print()" title="Imprimir carta">
        <i class="fas fa-print"></i>
    </div>

    <!-- Notificações -->
    <div id="notification" class="notification"></div>

    <script>
        // Efeito de digitação no nome
        function typeWriterEffect() {
            const nameElement = document.getElementById('animated-name');
            const originalText = nameElement.textContent;
            nameElement.textContent = '';
            
            let i = 0;
            function typeWriter() {
                if (i < originalText.length) {
                    nameElement.textContent += originalText.charAt(i);
                    i++;
                    setTimeout(typeWriter, 100);
                }
            }
            
            setTimeout(typeWriter, 500);
        }

        // Efeito de realce progressivo nos parágrafos
        function highlightParagraphs() {
            const paragraphs = document.querySelectorAll('.letter-text p');
            paragraphs.forEach((p, index) => {
                setTimeout(() => {
                    p.style.opacity = '1';
                    p.style.transform = 'translateY(0)';
                }, index * 200);
                
                p.style.opacity = '0';
                p.style.transform = 'translateY(10px)';
                p.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            });
        }

        // Compartilhamento
        function shareCarta() {
            if (navigator.share) {
                navigator.share({
                    title: 'Carta de Gratidão para Késsia',
                    text: 'Uma carta especial de gratidão e admiração',
                    url: window.location.href
                })
                .then(() => showNotification('Carta compartilhada com sucesso!', 'success'))
                .catch(error => console.log('Erro ao compartilhar:', error));
            } else {
                // Fallback para copiar link
                navigator.clipboard.writeText(window.location.href)
                    .then(() => showNotification('Link copiado para a área de transferência!', 'success'))
                    .catch(err => showNotification('Erro ao copiar link', 'error'));
            }
        }

        // Mostrar notificação
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Efeito de confetes
        function createSubtleConfetti() {
            const colors = ['#3498db', '#2ecc71', '#9b59b6', '#e74c3c', '#f1c40f'];
            const symbols = ['❖', '◆', '◇', '◈', '✦'];

            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.opacity = '0.1';
                confetti.style.fontSize = Math.random() * 10 + 10 + 'px';
                confetti.style.top = '-20px';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.zIndex = '9999';
                confetti.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                document.body.appendChild(confetti);

                const animation = confetti.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 0.1 },
                    { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
                ], {
                    duration: 2000 + Math.random() * 2000,
                    easing: 'cubic-bezier(0.215, 0.610, 0.355, 1)'
                });

                animation.onfinish = () => confetti.remove();
            }
        }

        // Inicializar efeitos
        document.addEventListener('DOMContentLoaded', function() {
            typeWriterEffect();
            highlightParagraphs();
            
            // Efeitos iniciais
            setTimeout(() => {
                createSubtleConfetti();
                showNotification('Carta carregada com sucesso!', 'success');
            }, 1000);
            
            // Verificar se é mobile
            if (/Mobi|Android/i.test(navigator.userAgent)) {
                document.body.classList.add('mobile');
            }
            
            // Atualizar data se necessário
            const dateElement = document.querySelector('.letter-date');
            const today = new Date();
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            dateElement.textContent = today.toLocaleDateString('pt-BR', options);
        });

        // API para obter dados da carta
        async function fetchCartaData() {
            try {
                const response = await fetch('/api/carta');
                const data = await response.json();
                console.log('Dados da carta:', data);
                return data;
            } catch (error) {
                console.error('Erro ao buscar dados da carta:', error);
                return null;
            }
        }
    </script>
</body>
</html>